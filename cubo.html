<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
    <script src="twgl.js-5.2.0/dist/5.x/twgl-full.js"></script>
</head>

<body>
    <doctype html="">
        <!--Nuno Garcia, Faculdade de CiÃªncias, Universidade de Lisboa, 2021-->
        <title>Projeto</title>

        <canvas id="canvas" width: 100vw; height: 100vh; display: block; style="height: 100vh; width: 100vw"></canvas>
        <script id="vs" type="notjs">
            uniform mat4 u_worldViewProjection;
            uniform vec3 u_lightWorldPos;
            uniform mat4 u_world;
            uniform mat4 u_viewInverse;
            uniform mat4 u_worldInverseTranspose;
            
            attribute vec4 position;
            attribute vec3 normal;
            attribute vec2 texcoord;

            varying vec4 v_position;
            varying vec2 v_texCoord;
            varying vec3 v_normal;
            varying vec3 v_surfaceToLight;
            varying vec3 v_surfaceToView;

            void main() {
                v_texCoord = texcoord;
                v_position = u_worldViewProjection * position;
                v_normal = (u_worldInverseTranspose * vec4(normal, 0)).xyz;

                v_surfaceToLight = u_lightWorldPos - (u_world * position).xyz;
                v_surfaceToView = (u_viewInverse[3] - (u_world * position)).xyz;

                gl_Position = v_position;
            }
            
      </script>
        <script id="fs" type="notjs">
            precision mediump float;
            
            varying vec2 v_texCoord;
            uniform sampler2D textura;
            
            
            void main() {
            gl_FragColor = texture2D(textura, v_texCoord);
            }
      
      </script>
        <script>
            const m4 = twgl.m4;
            const gl = document.querySelector("canvas").getContext("webgl");
            const programInfo = twgl.createProgramInfo(gl, ["vs", "fs"]);

            const bufferInfo = twgl.primitives.createCubeBufferInfo(gl, 2);
            var tex = twgl.createTexture(gl, {
                mag: gl.NEAREST,
                min: gl.LINEAR,
                src: [
                    255, 255, 255, 255,
                    192, 192, 192, 255,
                    192, 192, 192, 255,
                    255, 255, 255, 255,
                ]
            });
            var tex = twgl.createTexture(gl, { src: 'GrassBlock.jpg' });
            const uniforms = {};

            function render(time) {
                time = time * 0.001;
                twgl.resizeCanvasToDisplaySize(gl.canvas);
                gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

                gl.enable(gl.DEPTH_TEST);
                gl.clearColor(0, 0, 0, 0);
                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

                const fov = 30 * Math.PI / 180;
                const aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
                const zNear = 0.5;
                const zFar = 20;
                const projection = m4.perspective(fov, aspect, zNear, zFar);

                const eye = [0, 0, -10];
                const target = [0, 0, 0];
                const up = [0, 1, 0];
                const camera = m4.lookAt(eye, target, up);
                const view = m4.inverse(camera);

                const viewProjection = m4.multiply(projection, view);
                const world = m4.identity();
                //var world = identity;
                //translate(world, [], world)
                m4.rotateX(world, time, world)
                m4.rotateZ(world, time, world)
                m4.rotateY(world, time, world)

                uniforms.u_world = world;
                uniforms.u_worldViewProjection = m4.multiply(viewProjection, world);
                uniforms.textura = tex;

                gl.useProgram(programInfo.program);
                twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);
                twgl.setUniforms(programInfo, uniforms);
                twgl.drawBufferInfo(gl, bufferInfo);

                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        </script>
</body>

</html>