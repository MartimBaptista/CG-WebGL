<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
    <script src="twgl.js-5.2.0/dist/5.x/twgl-full.js"></script>
</head>

<body style="background-color: black;">
    <doctype html="">
        <!--Nuno Garcia, Faculdade de CiÃªncias, Universidade de Lisboa, 2021-->
        <title>Projeto</title>

        <canvas id="canvas" width: 100vw; height: 100vh; display: block; style="height: 100vh; width: 100vw"></canvas>
        <script id="vs" type="notjs">
            uniform mat4 u_worldViewProjection;
            uniform vec3 u_lightWorldPos;
            uniform mat4 u_world;
            uniform mat4 u_viewInverse;
            uniform mat4 u_worldInverseTranspose;
            
            attribute vec4 position;
            attribute vec3 normal;
            attribute vec2 texcoord;

            varying vec4 v_position;
            varying vec2 v_texCoord;
            varying vec3 v_normal;
            varying vec3 v_surfaceToLight;
            varying vec3 v_surfaceToView;

            void main() {
                v_texCoord = texcoord;
                v_position = u_worldViewProjection * position;
                v_normal = (u_worldInverseTranspose * vec4(normal, 0)).xyz;

                v_surfaceToLight = u_lightWorldPos - (u_world * position).xyz;
                v_surfaceToView = (u_viewInverse[3] - (u_world * position)).xyz;

                gl_Position = v_position;
            }
            
      </script>
        <script id="fs" type="notjs">
            precision mediump float;

            varying vec4 v_position;
            varying vec2 v_texCoord;
            varying vec3 v_normal;
            varying vec3 v_surfaceToLight;
            varying vec3 v_surfaceToView;

            uniform vec4 u_lightColor;
            uniform vec4 u_ambient;
            uniform sampler2D u_diffuse;
            uniform vec4 u_specular;
            uniform float u_shininess;
            uniform float u_specularFactor;

            vec4 lit(float l ,float h, float m) {
              return vec4(1.0,
                          max(l, 0.0),
                          (l > 0.0) ? pow(max(0.0, h), m) : 0.0,
                          1.0);
            //   return vec4(ambient, diffuse, specular, 1.0);
            }

            void main() {
              vec4 diffuseColor = texture2D(u_diffuse, v_texCoord);
              vec3 a_normal = normalize(v_normal);
              vec3 surfaceToLight = normalize(v_surfaceToLight);
              vec3 surfaceToView = normalize(v_surfaceToView);
            
              vec3 halfVector = normalize( surfaceToLight + surfaceToView );
            
              vec4 litR = lit(dot(a_normal, surfaceToLight),
                                dot(a_normal, halfVector), u_shininess);
            
              vec4 outColor = vec4((
                u_lightColor * (diffuseColor * litR.y + diffuseColor * u_ambient +
                            u_specular * litR.z * u_specularFactor)).rgb,
                  diffuseColor.a);
            
                gl_FragColor = 0.4*outColor + 0.6*diffuseColor;
            }
      
      </script>
        <script>
            const m4 = twgl.m4;
            const gl = document.querySelector("canvas").getContext("webgl");
            const programInfo = twgl.createProgramInfo(gl, ["vs", "fs"]);

            const sun = twgl.primitives.createSphereBufferInfo(gl, 5, 100, 100);
            const mercury = twgl.primitives.createSphereBufferInfo(gl, 0.7, 100, 100);
            const venus = twgl.primitives.createSphereBufferInfo(gl, 1, 100, 100);
            const earth = twgl.primitives.createSphereBufferInfo(gl, 1, 100, 100);
            const moon = twgl.primitives.createSphereBufferInfo(gl, 0.4, 100, 100);
            const mars = twgl.primitives.createSphereBufferInfo(gl, 1, 100, 100);

            var sun_tex = twgl.createTexture(gl, { src: '2k_sun.jpg' });
            var mercury_tex = twgl.createTexture(gl, { src: '2k_mercury.jpg' });
            var venus_tex = twgl.createTexture(gl, { src: '2k_venus_surface.jpg' });
            var earth_tex = twgl.createTexture(gl, { src: '2k_earth_daymap.jpg' });
            var moon_tex = twgl.createTexture(gl, { src: '2k_moon.jpg' });
            var mars_tex = twgl.createTexture(gl, { src: '2k_mars.jpg' });


            const sun_uniforms = {
                u_lightWorldPos: [0, 0, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: sun_tex,
            };

            const mercury_uniforms = {
                u_lightWorldPos: [0, 10, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: mercury_tex,
            };

            const venus_uniforms = {
                u_lightWorldPos: [0, 10, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: venus_tex,
            };
            const earth_uniforms = {
                u_lightWorldPos: [0, 10, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: earth_tex,
            };

            const moon_uniforms = {
                u_lightWorldPos: [0, 10, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: moon_tex,
            };

            const mars_uniforms = {
                u_lightWorldPos: [0, 10, 0],
                u_lightColor: [1, 1, 1, 1],
                u_ambient: [0, 0, 0, 1],
                u_specular: [1, 1, 1, 1],
                u_shininess: 10,
                u_specularFactor: 0.5,
                u_diffuse: mars_tex,
            };

            function render(time) {
                time = time * 0.001;
                twgl.resizeCanvasToDisplaySize(gl.canvas);
                gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

                gl.enable(gl.DEPTH_TEST);
                gl.clearColor(0, 0, 0, 1);
                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

                const fov = 30 * Math.PI / 180;
                const aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
                const zNear = 0.5;
                const zFar = 200;
                const projection = m4.perspective(fov, aspect, zNear, zFar);

                const eye = [0, 0, 150];
                const target = [0, 0, 0];
                const up = [0, 1, 0];
                const camera = m4.lookAt(eye, target, up);
                const view = m4.inverse(camera);

                const viewProjection = m4.multiply(projection, view);
                gl.useProgram(programInfo.program);

                //Sun:
                const sun_pos = m4.identity();
                //Parent Body Location
                m4.translate(sun_pos, [0,0,0,1], sun_pos)
                
                //rotation and inclination
                m4.rotateY(sun_pos, time, sun_pos)
                
                sun_uniforms.u_viewInverse = camera;
                sun_uniforms.u_world = sun_pos;
                sun_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(sun_pos));
                sun_uniforms.u_worldViewProjection = m4.multiply(viewProjection, sun_pos);

                twgl.setUniforms(programInfo, sun_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, sun);
                twgl.drawBufferInfo(gl, sun);
                //

                //Mercury:
                const mercury_pos = m4.identity();
                //Parent Body Location
                m4.translate(mercury_pos, [0,0,0,1], mercury_pos)
                //translation around Sun
                m4.rotateY(mercury_pos, time*2, mercury_pos)
                m4.translate(mercury_pos, [8,0,0,1], mercury_pos)
                m4.rotateY(mercury_pos, time*-2, mercury_pos)
                //rotation and inclination
                m4.rotateZ(mercury_pos, 0.4, mercury_pos)
                m4.rotateY(mercury_pos, time, mercury_pos)
                
                mercury_uniforms.u_viewInverse = camera;
                mercury_uniforms.u_world = mercury_pos;
                mercury_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(mercury_pos));
                mercury_uniforms.u_worldViewProjection = m4.multiply(viewProjection, mercury_pos);

                twgl.setUniforms(programInfo, mercury_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, mercury);
                twgl.drawBufferInfo(gl, mercury);
                //

                //Venus:
                const venus_pos = m4.identity();
                //Parent Body Location
                m4.translate(venus_pos, [0,0,0,1], venus_pos)
                //translation around Sun
                m4.rotateY(venus_pos, time*1.5, venus_pos)
                m4.translate(venus_pos, [12,0,0,1], venus_pos)
                m4.rotateY(venus_pos, time*-1.5, venus_pos)
                //rotation and inclination
                m4.rotateZ(venus_pos, 0.4, venus_pos)
                m4.rotateY(venus_pos, time, venus_pos)
                
                venus_uniforms.u_viewInverse = camera;
                venus_uniforms.u_world = venus_pos;
                venus_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(venus_pos));
                venus_uniforms.u_worldViewProjection = m4.multiply(viewProjection, venus_pos);

                twgl.setUniforms(programInfo, venus_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, venus);
                twgl.drawBufferInfo(gl, venus);
                //

                //Earth:
                const earth_pos = m4.identity();
                terra = m4.identity();
                //Parent Body Location
                m4.translate(earth_pos, [0,0,0,1], earth_pos)
                //translation around Sun
                m4.rotateY(earth_pos, time, earth_pos)
                m4.translate(earth_pos, [18,0,0,1], earth_pos)
                m4.rotateY(earth_pos, time*-1, earth_pos)
                m4.copy(earth_pos, terra)
                //rotation and inclination
                m4.rotateZ(earth_pos, 0.4, earth_pos)
                m4.rotateY(earth_pos, time, earth_pos)
                
                earth_uniforms.u_viewInverse = camera;
                earth_uniforms.u_world = earth_pos;
                earth_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(earth_pos));
                earth_uniforms.u_worldViewProjection = m4.multiply(viewProjection, earth_pos);

                twgl.setUniforms(programInfo, earth_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, earth);
                twgl.drawBufferInfo(gl, earth);
                //

                //Moon:
                const moon_pos = m4.identity();
                //Parent Body Location
                m4.copy(terra, moon_pos)
                //translation around Earth
                m4.rotateY(moon_pos, time*2, moon_pos)
                m4.translate(moon_pos, [2.4,0,0,1], moon_pos)
                m4.rotateY(moon_pos, time*-2, moon_pos)
                //rotation and inclination
                m4.rotateZ(moon_pos, 0.2, moon_pos)
                m4.rotateY(moon_pos, time*-0.5, moon_pos)
                
                moon_uniforms.u_viewInverse = camera;
                moon_uniforms.u_world = moon_pos;
                moon_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(moon_pos));
                moon_uniforms.u_worldViewProjection = m4.multiply(viewProjection, moon_pos);

                twgl.setUniforms(programInfo, moon_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, moon);
                twgl.drawBufferInfo(gl, moon);
                //

                //Mars:
                const mars_pos = m4.identity();
                //Parent Body Location
                m4.translate(mars_pos, [0,0,0,1], mars_pos)
                //translation around Sun
                m4.rotateY(mars_pos, time*0.5, mars_pos)
                m4.translate(mars_pos, [25,0,0,1], mars_pos)
                m4.rotateY(mars_pos, time*-0.5, mars_pos)
                //rotation and inclination
                m4.rotateZ(mars_pos, 0.4, mars_pos)
                m4.rotateY(mars_pos, time, mars_pos)
                
                mars_uniforms.u_viewInverse = camera;
                mars_uniforms.u_world = mars_pos;
                mars_uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(mars_pos));
                mars_uniforms.u_worldViewProjection = m4.multiply(viewProjection, mars_pos);

                twgl.setUniforms(programInfo, mars_uniforms);
                twgl.setBuffersAndAttributes(gl, programInfo, mars);
                twgl.drawBufferInfo(gl, mars);
                //

                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        </script>
</body>

</html>